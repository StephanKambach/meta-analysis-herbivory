library(metafor)
library(ggplot2)
setwd("S:\\users\\kambach\\PhD\\Project_I_Meta_analysis_BD_and_stability\\Data\\R")
data = read.table("Coding_Table_Shannon_Diversity_with_clim.txt",header=TRUE, sep="\t",dec=",",na.strings="NA")
data.frame(names(data))
str(data)
#functions
as.numeric.factor = function(x) {as.numeric(levels(x))[x]}
fisher.to.r = function(x){round(((exp(1)^(2*x))-1)/((exp(1)^(2*x))+1),6)}
#calculate z-score
data$R_VALUE = (data$BETA_ESTIMATE*sqrt(data$R_SQUARE))/ sqrt(data$BETA_ESTIMATE^2)
data$Z_SCORE = 0.5 * log((1 + data$R_VALUE)/(1-data$R_VALUE))
data$VARIANCE_ESTIMATE = 1/(data$PLOT_NUMBER-3)
#order and clean the table and construct a unique study identifier
data = data[order(data$Z_SCORE),]
data$UNIQUE_ID <- paste(data$AUTHOR,data$YEAR,data$FOREST_NAME,data$SAMPLING_ON, sep=" ")
data$UNIQUE_ID <- paste(data$UNIQUE_ID,data$HERBIVORE_SPECIES, sep=": ")
data$UNIQUE_ID <- paste(data$UNIQUE_ID,data$FOCAL_SPECIES, sep=" on ")
#exclude non-shannon treee diversities
dat.filtered = subset(data, TREE_DIV_METRIC %in% "shannon")
#write.table(dat.filtered,"for_the_map.txt",sep=";",dec=".",quote=FALSE,row.names=FALSE)
# convert GPS_DEZ_Y to just positive values
#data$GPS_DEZ_Y <- sqrt(data$GPS_DEZ_Y^2)
#heterogeneity between herbivore damage and abundance--------
#####################################################
dat.damage.abundance <- subset(dat.filtered, !(VARIANCE_ESTIMATE == Inf)  & VARIANCE_ESTIMATE >= 0 & !(Z_SCORE %in% NaN) & !(Z_SCORE %in% Inf)
& !(Z_SCORE %in% NA)
& HERBIVORE_GUILD %in% "insects"
& !(DAMAGE_OR_HERBIVORES %in% "richness"))
#write.table(dat.damage.abundance,"data_frame_damage_abundance_insects.csv", sep=";",dec=",",row.names=F)
#without difference between damage, abundance and richness
rma.damage.abundance.empty <- rma.mv(Z_SCORE, VARIANCE_ESTIMATE,method="REML",
random=~ list(1|factor(CASE_ID))+list(1|factor(STUDY_ID)),
data=dat.damage.abundance)
rma.damage.abundance.empty
forest(rma.damage.abundance.empty)
funnel(rma.damage.abundance.empty)
regtest(rma.damage.abundance.empty)
rma.damage.abundance.full <- rma.mv(Z_SCORE, VARIANCE_ESTIMATE,method="REML",
mods=~ factor(DAMAGE_OR_HERBIVORES)*bio1,
random=~ list(1|factor(CASE_ID))+list(1|factor(STUDY_ID)),
data=dat.damage.abundance)
rma.damage.abundance.bio1 <- rma.mv(Z_SCORE, VARIANCE_ESTIMATE,method="REML",
mods=~ bio1,
random=~ list(1|factor(CASE_ID))+list(1|factor(STUDY_ID)),
data=dat.damage.abundance)
rma.damage.abundance.bio1
rma.damage.abundance.full
?rma.mv
rma.damage.abundance.empty
View(data)
data[which(data$DAMAGE_OR_HERBIVORES %in% "richness")]
data[which(data$DAMAGE_OR_HERBIVORES %in% "richness"),]
dat.damage.abundance <- subset(dat.filtered, !(VARIANCE_ESTIMATE == Inf)  & VARIANCE_ESTIMATE >= 0 & !(Z_SCORE %in% NaN) & !(Z_SCORE %in% Inf)
& !(Z_SCORE %in% NA)
& HERBIVORE_GUILD %in% "insects")
dat.damage.abundance[which(dat.damage.abundance$DAMAGE_OR_HERBIVORES %in% "richness"),]
View(dat.filtered)
test = dat.damage.abundance[which(dat.damage.abundance$DAMAGE_OR_HERBIVORES %in% "richness"),]
View(test)
setwd("C:\\Users\\kambach\\Desktop\\aktuelle Arbeiten\\Meta-analysis Herbivory\\Code\\meta-analysis-herbivory")
